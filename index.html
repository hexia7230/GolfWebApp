<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>„Ç¥„É´„ÉïÁµ±Ë®àPro</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.0/chart.umd.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #2E7D32 0%, #1B5E20 100%);
            min-height: 100vh;
            padding: 10px;
        }
        
        .container {
            max-width: 480px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
            animation: slideIn 0.4s ease-out;
        }
        
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .header {
            background: linear-gradient(135deg, #2E7D32 0%, #1B5E20 100%);
            color: white;
            padding: 24px 20px;
            text-align: center;
            position: relative;
        }
        
        .settings-btn {
            position: absolute;
            right: 20px;
            top: 24px;
            background: rgba(255,255,255,0.2);
            border: none;
            color: white;
            padding: 8px 12px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s;
        }
        
        .settings-btn:hover {
            background: rgba(255,255,255,0.3);
            transform: rotate(90deg);
        }
        
        h1 {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 12px;
        }
        
        .mode-toggle {
            margin-top: 12px;
            display: flex;
            gap: 8px;
            justify-content: center;
        }
        
        .mode-btn {
            background: rgba(255,255,255,0.2);
            border: none;
            color: white;
            padding: 8px 20px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 13px;
            transition: all 0.3s;
        }
        
        .mode-btn.active {
            background: white;
            color: #2E7D32;
            transform: scale(1.05);
        }
        
        .content {
            padding: 20px;
        }
        
        .hole-header {
            background: linear-gradient(135deg, #E8F5E9, #C8E6C9);
            padding: 20px;
            border-radius: 16px;
            margin-bottom: 20px;
            animation: fadeIn 0.3s ease-out;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        .hole-info-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }
        
        .hole-info {
            font-size: 22px;
            font-weight: 700;
            color: #1B5E20;
        }
        
        .shot-number {
            font-size: 18px;
            color: #2E7D32;
            font-weight: 600;
        }
        
        .hole-par {
            font-size: 14px;
            color: #666;
        }
        
        .par-select {
            padding: 6px 12px;
            border: 2px solid #2E7D32;
            border-radius: 8px;
            margin-left: 8px;
            background: white;
            transition: all 0.3s;
        }
        
        .par-select:focus {
            outline: none;
            border-color: #1B5E20;
            box-shadow: 0 0 0 3px rgba(46,125,50,0.1);
        }
        
        .input-section {
            background: #F8F9FA;
            padding: 20px;
            border-radius: 16px;
            margin-bottom: 20px;
            transition: all 0.3s;
        }
        
        .input-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin-bottom: 16px;
        }
        
        .input-group {
            margin-bottom: 16px;
        }
        
        .input-label {
            font-size: 13px;
            font-weight: 600;
            color: #555;
            margin-bottom: 8px;
            display: block;
        }
        
        select, input {
            width: 100%;
            padding: 12px;
            border: 2px solid #E0E0E0;
            border-radius: 10px;
            font-size: 15px;
            background: white;
            transition: all 0.3s;
        }
        
        select:focus, input:focus {
            outline: none;
            border-color: #2E7D32;
            box-shadow: 0 0 0 3px rgba(46,125,50,0.1);
            transform: translateY(-2px);
        }
        
        .result-btns {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
        }
        
        .result-btn {
            padding: 16px;
            border: 2px solid #E0E0E0;
            background: white;
            color: #666;
            border-radius: 12px;
            font-size: 22px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }
        
        .result-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        
        .result-btn.active {
            border-color: #2E7D32;
            background: #2E7D32;
            color: white;
            transform: scale(1.05);
        }
        
        .advanced-only {
            display: none;
        }
        
        .advanced-only.show {
            display: block;
            animation: slideDown 0.3s ease-out;
        }
        
        @keyframes slideDown {
            from {
                opacity: 0;
                max-height: 0;
            }
            to {
                opacity: 1;
                max-height: 500px;
            }
        }
        
        .action-btns {
            display: grid;
            gap: 12px;
            margin-bottom: 20px;
        }
        
        .add-shot-btn, .finish-hole-btn {
            padding: 16px;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .add-shot-btn {
            background: linear-gradient(135deg, #2E7D32, #1B5E20);
            color: white;
        }
        
        .add-shot-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(46,125,50,0.3);
        }
        
        .finish-hole-btn {
            background: linear-gradient(135deg, #1976D2, #1565C0);
            color: white;
        }
        
        .finish-hole-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(25,118,210,0.3);
        }
        
        .current-shots {
            background: linear-gradient(135deg, #FFF9C4, #FFF59D);
            padding: 16px;
            border-radius: 12px;
            margin-bottom: 16px;
            max-height: 200px;
            overflow-y: auto;
            border: 2px solid #FDD835;
            animation: fadeIn 0.3s;
        }
        
        .shot-item {
            padding: 12px;
            background: white;
            border-radius: 8px;
            margin-bottom: 8px;
            font-size: 13px;
            color: #333;
            border-left: 4px solid #2E7D32;
            animation: slideIn 0.3s;
        }
        
        .tabs {
            display: flex;
            gap: 0;
            margin: 20px 0;
            background: #F5F5F5;
            border-radius: 12px;
            padding: 6px;
            overflow-x: auto;
        }
        
        .tab {
            flex: 1;
            padding: 12px 10px;
            background: transparent;
            border: none;
            color: #666;
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            border-radius: 8px;
            white-space: nowrap;
            transition: all 0.3s;
        }
        
        .tab:hover {
            background: rgba(46,125,50,0.1);
        }
        
        .tab.active {
            background: white;
            color: #2E7D32;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            transform: translateY(-2px);
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
            animation: fadeIn 0.3s;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin-bottom: 20px;
        }
        
        .stat-card {
            background: #F8F9FA;
            padding: 16px;
            border-radius: 12px;
            text-align: center;
            transition: all 0.3s;
        }
        
        .stat-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.1);
        }
        
        .stat-label {
            font-size: 11px;
            color: #666;
            margin-bottom: 6px;
            font-weight: 600;
        }
        
        .stat-value {
            font-size: 24px;
            font-weight: 700;
            color: #2E7D32;
        }
        
        .stat-card.highlight {
            background: linear-gradient(135deg, #2E7D32, #1B5E20);
        }
        
        .stat-card.highlight .stat-label,
        .stat-card.highlight .stat-value {
            color: white;
        }
        
        .section-title {
            font-size: 15px;
            font-weight: 700;
            color: #1B5E20;
            margin: 20px 0 12px 0;
        }
        
        .chart-container {
            background: white;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .chart-title {
            font-size: 14px;
            font-weight: 700;
            color: #1B5E20;
            margin-bottom: 16px;
            text-align: center;
        }
        
        .heatmap {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 8px;
            margin-top: 12px;
        }
        
        .heatmap-cell {
            aspect-ratio: 1;
            border-radius: 8px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            font-weight: 600;
            transition: all 0.3s;
        }
        
        .heatmap-cell:hover {
            transform: scale(1.1);
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.6);
            z-index: 1000;
            padding: 20px;
            backdrop-filter: blur(4px);
        }
        
        .modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
            animation: fadeIn 0.3s;
        }
        
        .modal-content {
            background: white;
            border-radius: 20px;
            padding: 24px;
            max-width: 400px;
            width: 100%;
            max-height: 80vh;
            overflow-y: auto;
            animation: slideIn 0.3s;
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .modal-title {
            font-size: 20px;
            font-weight: 700;
            color: #1B5E20;
        }
        
        .close-modal-btn {
            background: #E0E0E0;
            border: none;
            color: #666;
            padding: 8px 16px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }
        
        .close-modal-btn:hover {
            background: #BDBDBD;
        }
        
        .baseline-section {
            background: #F8F9FA;
            padding: 16px;
            border-radius: 12px;
            margin-bottom: 16px;
        }
        
        .baseline-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid #E0E0E0;
        }
        
        .baseline-item:last-child {
            border-bottom: none;
        }
        
        .club-list {
            margin-bottom: 12px;
        }
        
        .club-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            background: #F5F5F5;
            border-radius: 8px;
            margin-bottom: 8px;
            transition: all 0.3s;
        }
        
        .club-item:hover {
            background: #E8F5E9;
        }
        
        .remove-club-btn {
            background: #FF5722;
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
            font-weight: 600;
            transition: all 0.3s;
        }
        
        .remove-club-btn:hover {
            background: #E64A19;
            transform: scale(1.05);
        }
        
        .add-club-section {
            display: flex;
            gap: 8px;
            margin-top: 12px;
        }
        
        .add-club-input {
            flex: 1;
            padding: 10px;
            border: 2px solid #E0E0E0;
            border-radius: 8px;
        }
        
        .add-club-btn {
            background: #2E7D32;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }
        
        .add-club-btn:hover {
            background: #1B5E20;
            transform: translateY(-2px);
        }
        
        .reset-btn, .reset-baseline-btn {
            width: 100%;
            padding: 14px;
            border: none;
            border-radius: 10px;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            margin-top: 16px;
            transition: all 0.3s;
        }
        
        .reset-btn {
            background: linear-gradient(135deg, #D32F2F, #B71C1C);
            color: white;
        }
        
        .reset-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(211,47,47,0.3);
        }
        
        .reset-baseline-btn {
            background: #FF9800;
            color: white;
        }
        
        .reset-baseline-btn:hover {
            background: #F57C00;
            transform: translateY(-2px);
        }
        
        .help-text {
            font-size: 11px;
            color: #999;
            margin-top: 6px;
        }
        
        .empty-message {
            text-align: center;
            color: #999;
            padding: 40px 20px;
            font-size: 14px;
        }
        
        .scorecard {
            background: white;
            border: 2px solid #2E7D32;
            border-radius: 12px;
            overflow-x: auto;
            margin-bottom: 16px;
        }
        
        .scorecard-header, .scorecard-row {
            display: grid;
            grid-template-columns: 50px repeat(9, 1fr) 60px;
            gap: 1px;
            font-size: 11px;
            min-width: 550px;
        }
        
        .scorecard-header {
            background: #E8F5E9;
            padding: 10px;
            border-bottom: 2px solid #2E7D32;
            font-weight: 700;
            color: #1B5E20;
        }
        
        .scorecard-row {
            border-bottom: 1px solid #E0E0E0;
        }
        
        .scorecard-cell {
            padding: 10px 6px;
            text-align: center;
            background: white;
        }
        
        .scorecard-cell:first-child {
            font-weight: 700;
            background: #F5F5F5;
        }
        
        .scorecard-cell:last-child {
            background: #2E7D32;
            color: white;
            font-weight: 700;
        }
        
        .total-score {
            background: linear-gradient(135deg, #2E7D32, #1B5E20);
            color: white;
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            font-size: 18px;
            font-weight: 700;
            margin-top: 16px;
        }
        
        .records {
            max-height: 400px;
            overflow-y: auto;
        }
        
        .hole-record {
            background: #F8F9FA;
            border-radius: 12px;
            padding: 14px;
            margin-bottom: 10px;
            border-left: 4px solid #2E7D32;
            transition: all 0.3s;
        }
        
        .hole-record:hover {
            background: #E8F5E9;
            transform: translateX(4px);
        }
        
        .hole-record-header {
            font-weight: 700;
            color: #1B5E20;
            margin-bottom: 10px;
            font-size: 15px;
        }
        
        .shot-detail {
            font-size: 12px;
            color: #666;
            margin-bottom: 6px;
            padding: 6px 10px;
            background: white;
            border-radius: 6px;
        }
        
        .sg-card {
            background: linear-gradient(135deg, #667eea, #764ba2);
        }
        
        .sg-card .stat-label,
        .sg-card .stat-value {
            color: white;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <button class="settings-btn" onclick="openSettings()">‚öôÔ∏è</button>
            <h1>‚õ≥ „Ç¥„É´„ÉïÁµ±Ë®àPro</h1>
            <div class="mode-toggle">
                <button class="mode-btn active" onclick="confirmModeChange('simple')" id="modeSimple">„Ç∑„É≥„Éó„É´</button>
                <button class="mode-btn" onclick="confirmModeChange('advanced')" id="modeAdvanced">„Ç¢„Éâ„Éê„É≥„Çπ„Éâ</button>
            </div>
        </div>
        
        <div class="content">
            <div class="hole-header">
                <div class="hole-info-row">
                    <div class="hole-info">„Éõ„Éº„É´ <span id="currentHole">1</span></div>
                    <div class="shot-number"><span id="shotCount">1</span>ÊâìÁõÆ</div>
                </div>
                <div class="hole-par">
                    Par: <select class="par-select" id="holePar">
                        <option value="3">3</option>
                        <option value="4" selected>4</option>
                        <option value="5">5</option>
                    </select>
                </div>
            </div>
            
            <div class="input-section">
                <div class="input-row">
                    <div class="input-group">
                        <label class="input-label">Áä∂Ê≥Å</label>
                        <select id="situation">
                            <option value="„ÉÜ„Ç£„Éº„Ç∞„É©„Ç¶„É≥„Éâ">„ÉÜ„Ç£„Éº„Ç∞„É©„Ç¶„É≥„Éâ</option>
                            <option value="„Éï„Çß„Ç¢„Ç¶„Çß„Ç§">„Éï„Çß„Ç¢„Ç¶„Çß„Ç§</option>
                            <option value="„É©„Éï">„É©„Éï</option>
                            <option value="„Éê„É≥„Ç´„Éº">„Éê„É≥„Ç´„Éº</option>
                            <option value="„Ç∞„É™„Éº„É≥">„Ç∞„É™„Éº„É≥</option>
                        </select>
                    </div>
                    <div class="input-group">
                        <label class="input-label">Áï™Êâã</label>
                        <select id="club"></select>
                    </div>
                </div>
                
                <div class="input-group">
                    <label class="input-label" id="distanceLabel">È£õË∑ùÈõ¢ (yd)</label>
                    <input type="number" id="distanceBefore" placeholder="200" min="0" step="0.1">
                    <div class="help-text" id="distanceHelp">Êâì„Å£„ÅüË∑ùÈõ¢„ÇíÂÖ•Âäõ</div>
                </div>
                
                <div class="input-group advanced-only" id="distanceAfterGroup">
                    <label class="input-label">Êâì„Å£„ÅüÂæå„ÅÆÊÆãË∑ùÈõ¢ (yd/m)</label>
                    <input type="number" id="distanceAfter" placeholder="5" min="0" step="0.1">
                    <div class="help-text">„Ç´„ÉÉ„Éó„Ç§„É≥„Åó„ÅüÂ†¥Âêà„ÅØ0„ÄÅ„Ç∞„É™„Éº„É≥‰∏ä„Å™„Çâ„É°„Éº„Éà„É´„ÅßÂÖ•Âäõ</div>
                </div>
                
                <div class="input-group advanced-only" id="slopeGroup">
                    <label class="input-label">ÂÇæÊñú</label>
                    <select id="slope">
                        <option value="Âπ≥Âù¶">Âπ≥Âù¶</option>
                        <option value="‰∏ä„ÇäËªΩ">‰∏ä„ÇäÔºàËªΩÔºâ</option>
                        <option value="‰∏ä„ÇäÂº∑">‰∏ä„ÇäÔºàÂº∑Ôºâ</option>
                        <option value="‰∏ã„ÇäËªΩ">‰∏ã„ÇäÔºàËªΩÔºâ</option>
                        <option value="‰∏ã„ÇäÂº∑">‰∏ã„ÇäÔºàÂº∑Ôºâ</option>
                    </select>
                </div>
                
                <div class="input-group advanced-only" id="greenConditionGroup">
                    <label class="input-label">Ëäù„ÅÆÁä∂ÊÖã</label>
                    <select id="greenCondition">
                        <option value="ËâØÂ•Ω">ËâØÂ•Ω</option>
                        <option value="ÊôÆÈÄö">ÊôÆÈÄö</option>
                        <option value="Èáç„ÅÑ">Èáç„ÅÑ</option>
                        <option value="ÈÄü„ÅÑ">ÈÄü„ÅÑ</option>
                    </select>
                </div>
                
                <div class="input-group advanced-only" id="windGroup">
                    <label class="input-label">È¢®Âêë„Åç</label>
                    <select id="wind">
                        <option value="ÁÑ°È¢®">ÁÑ°È¢®</option>
                        <option value="„Éï„Ç©„É≠„ÉºÂº±">„Éï„Ç©„É≠„ÉºÔºàÂº±Ôºâ</option>
                        <option value="„Éï„Ç©„É≠„ÉºÂº∑">„Éï„Ç©„É≠„ÉºÔºàÂº∑Ôºâ</option>
                        <option value="„Ç¢„Ç≤„Ç§„É≥„Çπ„ÉàÂº±">„Ç¢„Ç≤„Ç§„É≥„Çπ„ÉàÔºàÂº±Ôºâ</option>
                        <option value="„Ç¢„Ç≤„Ç§„É≥„Çπ„Éà‰∏≠">„Ç¢„Ç≤„Ç§„É≥„Çπ„ÉàÔºà‰∏≠Ôºâ</option>
                        <option value="„Ç¢„Ç≤„Ç§„É≥„Çπ„ÉàÂº∑">„Ç¢„Ç≤„Ç§„É≥„Çπ„ÉàÔºàÂº∑Ôºâ</option>
                        <option value="Ê®™È¢®Âº±">Ê®™È¢®ÔºàÂº±Ôºâ</option>
                        <option value="Ê®™È¢®Âº∑">Ê®™È¢®ÔºàÂº∑Ôºâ</option>
                    </select>
                </div>
                
                <div class="input-group">
                    <label class="input-label">ÁµêÊûú</label>
                    <div class="result-btns">
                        <button type="button" class="result-btn" onclick="selectResult(this, '‚óé')">‚óé</button>
                        <button type="button" class="result-btn" onclick="selectResult(this, '‚óã')">‚óã</button>
                        <button type="button" class="result-btn" onclick="selectResult(this, '‚ñ≥')">‚ñ≥</button>
                        <button type="button" class="result-btn" onclick="selectResult(this, '√ó')">√ó</button>
                    </div>
                </div>
            </div>
            
            <div class="current-shots" id="currentShots" style="display: none;"></div>
            
            <div class="action-btns">
                <button type="button" class="add-shot-btn" onclick="addShot()">‚ûï Êâì„ÇíËøΩÂä†</button>
                <button type="button" class="finish-hole-btn" onclick="finishHole()">‚úì „Éõ„Éº„É´ÁµÇ‰∫Ü</button>
                <button type="button" style="padding: 16px; background: linear-gradient(135deg, #FF9800, #F57C00); color: white; border: none; border-radius: 12px; font-size: 16px; font-weight: 600; cursor: pointer; transition: all 0.3s;" onclick="finishRound()" onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 8px 20px rgba(255,152,0,0.3)'" onmouseout="this.style.transform=''; this.style.boxShadow=''">üèÅ „É©„Ç¶„É≥„ÉâÁµÇ‰∫Ü</button>
            </div>
            
            <div class="tabs">
                <button type="button" class="tab active" onclick="switchTab('scorecard')">„Çπ„Ç≥„Ç¢Ë°®</button>
                <button type="button" class="tab" onclick="switchTab('stats')">Áµ±Ë®à</button>
                <button type="button" class="tab" onclick="switchTab('graphs')">„Ç∞„É©„Éï</button>
                <button type="button" class="tab advanced-only" onclick="switchTab('sg')" id="sgTabBtn">SGÂàÜÊûê</button>
                <button type="button" class="tab" onclick="switchTab('records')">Ë©≥Á¥∞</button>
            </div>
            
            <div id="scorecardTab" class="tab-content active">
                <div id="scorecardContainer">
                    <div class="empty-message">„Éá„Éº„Çø„Åå„ÅÇ„Çä„Åæ„Åõ„Çì</div>
                </div>
            </div>
            
            <div id="statsTab" class="tab-content">
                <div class="stats-grid">
                    <div class="stat-card highlight">
                        <div class="stat-label">Âπ≥Âùá„Çπ„Ç≥„Ç¢</div>
                        <div class="stat-value" id="avgScore">-</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Á∑è„Éõ„Éº„É´Êï∞</div>
                        <div class="stat-value" id="totalHoles">0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">FW„Ç≠„Éº„ÉóÁéá</div>
                        <div class="stat-value" id="fwRate">-</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">„Éë„Éº„Ç™„É≥Áéá</div>
                        <div class="stat-value" id="girRate">-</div>
                    </div>
                </div>
                
                <div class="section-title">üìè Âπ≥ÂùáÈ£õË∑ùÈõ¢</div>
                <div class="stats-grid" id="avgDistanceStats"></div>
                
                <div class="section-title">üéØ ÊàêÁ∏æ„Éá„Éº„Çø</div>
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-label">ÂØÑ„Åõ„ÉØ„É≥Áéá</div>
                        <div class="stat-value" id="upDownRate">-</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">„Çµ„É≥„Éâ„Çª„Éº„ÉñÁéá</div>
                        <div class="stat-value" id="sandSaveRate">-</div>
                    </div>
                </div>
                
                <div class="section-title">‚ö†Ô∏è „Éü„ÇπÂÇæÂêë</div>
                <div id="missStats" style="background: #F5F5F5; padding: 12px; border-radius: 8px; font-size: 13px; color: #666;"></div>
            </div>
            
            <div id="graphsTab" class="tab-content">
                <div class="chart-container">
                    <div class="chart-title">üìà „Çπ„Ç≥„Ç¢Êé®Áßª</div>
                    <canvas id="scoreChart"></canvas>
                </div>
                
                <div class="chart-container">
                    <div class="chart-title">üìä „Çπ„Ç≥„Ç¢ÂàÜÂ∏É</div>
                    <canvas id="scoreDistChart"></canvas>
                </div>
                
                <div class="chart-container">
                    <div class="chart-title">üéØ Ë∑ùÈõ¢Âà•ÊàêÂäüÁéá„Éí„Éº„Éà„Éû„ÉÉ„Éó</div>
                    <div class="heatmap" id="heatmap"></div>
                </div>
            </div>
            
            <div id="sgTab" class="tab-content">
                <div class="section-title">üèÜ Á∑èÂêàSG</div>
                <div class="stats-grid">
                    <div class="stat-card sg-card">
                        <div class="stat-label">SG: Total</div>
                        <div class="stat-value" id="sgTotal">-</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">SG: T2G</div>
                        <div class="stat-value" id="sgT2G">-</div>
                    </div>
                </div>
                
                <div class="section-title">üìä „Ç´„ÉÜ„Ç¥„É™Âà•SG</div>
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-label">SG: OTT</div>
                        <div class="stat-value" id="sgOTT">-</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">SG: APP</div>
                        <div class="stat-value" id="sgAPP">-</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">SG: ARG</div>
                        <div class="stat-value" id="sgARG">-</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">SG: PUT</div>
                        <div class="stat-value" id="sgPUT">-</div>
                    </div>
                </div>
                
                <div class="section-title">üéØ ÂÄã‰∫∫„Éô„Éº„Çπ„É©„Ç§„É≥ÊØîËºÉ</div>
                <div class="stat-card highlight">
                    <div class="stat-label">vs Ëá™ÂàÜ„ÅÆÂπ≥Âùá</div>
                    <div class="stat-value" id="sgVsBaseline">-</div>
                </div>
                <div class="help-text" style="text-align: center; margin-top: 8px;">10„É©„Ç¶„É≥„Éâ‰ª•‰∏ä„ÅßÊúâÂäπ</div>
                
                <div class="section-title">üéØ Áï™ÊâãÂà•SGÂàÜÊûê</div>
                <div id="clubSGStats" style="background: #F5F5F5; padding: 12px; border-radius: 8px; font-size: 13px; color: #666;">
                    „Éá„Éº„Çø„ÇíËøΩÂä†„Åó„Å¶„Åè„Å†„Åï„ÅÑ
                </div>
            </div>
            
            <div id="recordsTab" class="tab-content">
                <div class="records" id="records"></div>
            </div>
            
            <button type="button" class="reset-btn" onclick="resetAll()">üóëÔ∏è ÂÖ®„Å¶„É™„Çª„ÉÉ„Éà</button>
        </div>
    </div>
    
    <div class="modal" id="settingsModal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">Ë®≠ÂÆö</div>
                <button class="close-modal-btn" onclick="closeSettings()">Èñâ„Åò„Çã</button>
            </div>
            
            <div class="section-title">Áï™Êâã„Ç´„Çπ„Çø„Éû„Ç§„Ç∫</div>
            <div class="club-list" id="clubList"></div>
            <div class="add-club-section">
                <input type="text" class="add-club-input" id="newClubName" placeholder="Áï™ÊâãÂêçÔºà‰æã: 4UTÔºâ">
                <button class="add-club-btn" onclick="addCustomClub()">ËøΩÂä†</button>
            </div>
            
            <div class="section-title" style="margin-top: 24px;">ÂÄã‰∫∫„Éô„Éº„Çπ„É©„Ç§„É≥</div>
            <div class="baseline-section">
                <div id="baselineDisplay"></div>
            </div>
            <button class="reset-baseline-btn" onclick="resetBaseline()">„Éô„Éº„Çπ„É©„Ç§„É≥„Çí„É™„Çª„ÉÉ„Éà</button>
            <div class="help-text">10„É©„Ç¶„É≥„Éâ‰ª•‰∏ä„Åß„Éô„Éº„Çπ„É©„Ç§„É≥„ÅåËá™ÂãïÁîüÊàê„Åï„Çå„Åæ„Åô</div>
        </div>
    </div>
    
    <div class="modal" id="modeConfirmModal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">Á¢∫Ë™ç</div>
            </div>
            <div style="margin-bottom: 20px; color: #666;" id="modeConfirmText"></div>
            <div style="display: flex; gap: 10px;">
                <button style="flex: 1; padding: 12px; background: #E0E0E0; border: none; border-radius: 8px; cursor: pointer; font-weight: 600;" onclick="closeModeConfirm()">„ÅÑ„ÅÑ„Åà</button>
                <button style="flex: 1; padding: 12px; background: #2E7D32; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: 600;" onclick="executeModeChange()">„ÅØ„ÅÑ</button>
            </div>
        </div>
    </div>
    
    <script>
        const EXPECTED_STROKES_DETAILED = {};
        for (let d = 0; d <= 400; d += 5) {
            if (d <= 100) EXPECTED_STROKES_DETAILED[d] = 1.00 + (d / 100) * 1.82;
            else if (d <= 200) EXPECTED_STROKES_DETAILED[d] = 2.82 + ((d - 100) / 100) * 0.50;
            else EXPECTED_STROKES_DETAILED[d] = 3.32 + ((d - 200) / 200) * 1.00;
        }
        
        const PUTT_EXPECTED_DETAILED = {};
        for (let d = 1; d <= 15; d += 0.5) {
            PUTT_EXPECTED_DETAILED[d] = 1.20 + (d / 15) * 0.45;
        }
        
        const SLOPE_FACTORS = {
            'Âπ≥Âù¶': 1.00, '‰∏ä„ÇäËªΩ': 1.05, '‰∏ä„ÇäÂº∑': 1.12, '‰∏ã„ÇäËªΩ': 0.97, '‰∏ã„ÇäÂº∑': 0.92
        };
        
        const GREEN_FACTORS = {
            'ËâØÂ•Ω': 1.00, 'ÊôÆÈÄö': 1.03, 'Èáç„ÅÑ': 1.08, 'ÈÄü„ÅÑ': 0.95
        };
        
        const DEFAULT_CLUBS = ['DR', '3W', '5W', 'UT', '3I', '4I', '5I', '6I', '7I', '8I', '9I', 'PW', 'AW', 'SW', 'PT'];
        
        let holes = [];
        let currentHole = 1;
        let currentShots = [];
        let selectedResult = null;
        let appMode = 'simple';
        let pendingMode = null;
        let customClubs = [];
        let personalBaseline = null;
        let scoreChart = null;
        let distChart = null;
        
        function init() {
            loadData();
            updateClubSelect();
            updateModeUI();
            updateDisplay();
            calculateBaseline();
        }
        
        function loadData() {
            const saved = localStorage.getItem('golfStatsData');
            if (saved) {
                const data = JSON.parse(saved);
                holes = data.holes || [];
                customClubs = data.clubs || [...DEFAULT_CLUBS];
                appMode = data.mode || 'simple';
                personalBaseline = data.baseline || null;
            } else {
                customClubs = [...DEFAULT_CLUBS];
            }
        }
        
        function saveData() {
            localStorage.setItem('golfStatsData', JSON.stringify({
                holes, clubs: customClubs, mode: appMode, baseline: personalBaseline
            }));
        }
        
        function updateClubSelect() {
            const select = document.getElementById('club');
            select.innerHTML = customClubs.map(c => `<option value="${c}">${c}</option>`).join('');
        }
        
        function updateModeUI() {
            document.getElementById('modeSimple').classList.toggle('active', appMode === 'simple');
            document.getElementById('modeAdvanced').classList.toggle('active', appMode === 'advanced');
            
            document.querySelectorAll('.advanced-only').forEach(el => {
                el.classList.toggle('show', appMode === 'advanced');
            });
            
            const distLabel = document.getElementById('distanceLabel');
            const distHelp = document.getElementById('distanceHelp');
            const distInput = document.getElementById('distanceBefore');
            
            if (appMode === 'simple') {
                distLabel.textContent = 'È£õË∑ùÈõ¢ (yd)';
                distHelp.textContent = 'Êâì„Å£„ÅüË∑ùÈõ¢„ÇíÂÖ•Âäõ';
                distInput.placeholder = '200';
            } else {
                distLabel.textContent = 'Êâì„Å§Ââç„ÅÆÊÆãË∑ùÈõ¢ (yd)';
                distHelp.textContent = '„Ç∞„É™„Éº„É≥‰∏ä„ÅÆÂ†¥Âêà„ÅØ„É°„Éº„Éà„É´„ÅßÂÖ•Âäõ';
                distInput.placeholder = '150';
            }
        }
        
        function confirmModeChange(newMode) {
            if (appMode === newMode) return;
            
            if (currentShots.length > 0 || holes.length > 0) {
                pendingMode = newMode;
                const text = newMode === 'advanced' 
                    ? '„Ç¢„Éâ„Éê„É≥„Çπ„Éâ„É¢„Éº„Éâ„Å´Âàá„ÇäÊõø„Åà„Åæ„Åô„ÅãÔºüÂÖ•Âäõ„Éá„Éº„Çø„ÅØ‰øùÊåÅ„Åï„Çå„Åæ„Åô„Åå„ÄÅSGË®àÁÆó„Å´„ÅØÊñ∞„Åó„ÅÑ„Éá„Éº„Çø„ÅåÂøÖË¶Å„Åß„Åô„ÄÇ'
                    : '„Ç∑„É≥„Éó„É´„É¢„Éº„Éâ„Å´Âàá„ÇäÊõø„Åà„Åæ„Åô„ÅãÔºüSGÂàÜÊûêÊ©üËÉΩ„ÅåÁÑ°Âäπ„Å´„Å™„Çä„Åæ„Åô„ÄÇ';
                document.getElementById('modeConfirmText').textContent = text;
                document.getElementById('modeConfirmModal').classList.add('active');
            } else {
                appMode = newMode;
                updateModeUI();
                saveData();
            }
        }
        
        function closeModeConfirm() {
            document.getElementById('modeConfirmModal').classList.remove('active');
            pendingMode = null;
        }
        
        function executeModeChange() {
            appMode = pendingMode;
            updateModeUI();
            updateDisplay();
            saveData();
            closeModeConfirm();
        }
        
        function openSettings() {
            document.getElementById('settingsModal').classList.add('active');
            updateClubList();
            displayBaseline();
        }
        
        function closeSettings() {
            document.getElementById('settingsModal').classList.remove('active');
        }
        
        function updateClubList() {
            const list = document.getElementById('clubList');
            list.innerHTML = customClubs.map((club, i) => `
                <div class="club-item">
                    <span style="font-weight: 600;">${club}</span>
                    <button class="remove-club-btn" onclick="removeClub(${i})">ÂâäÈô§</button>
                </div>
            `).join('');
        }
        
        function addCustomClub() {
            const input = document.getElementById('newClubName');
            const name = input.value.trim();
            if (name && !customClubs.includes(name)) {
                customClubs.push(name);
                input.value = '';
                updateClubList();
                updateClubSelect();
                saveData();
            }
        }
        
        function removeClub(index) {
            if (confirm(`${customClubs[index]}„ÇíÂâäÈô§„Åó„Åæ„Åô„ÅãÔºü`)) {
                customClubs.splice(index, 1);
                updateClubList();
                updateClubSelect();
                saveData();
            }
        }
        
        function calculateBaseline() {
            if (holes.length < 10) return;
            
            const allShots = holes.flatMap(h => h.shots);
            const categories = { OTT: [], APP: [], ARG: [], PUT: [] };
            
            allShots.forEach(shot => {
                if (!shot.distanceAfter && shot.distanceAfter !== 0) return;
                const cat = getSGCategory(shot.shotNumber, shot.holePar || 4, shot.distanceBefore, shot.situation);
                const sg = calculateSG(shot.distanceBefore, shot.distanceAfter, shot.situation, 
                    shot.afterLie || '„Ç∞„É™„Éº„É≥', shot.wind || 'ÁÑ°È¢®', shot.slope || 'Âπ≥Âù¶', shot.greenCondition || 'ÊôÆÈÄö');
                categories[cat].push(sg);
            });
            
            personalBaseline = {};
            Object.keys(categories).forEach(cat => {
                if (categories[cat].length > 0) {
                    personalBaseline[cat] = categories[cat].reduce((a, b) => a + b, 0) / categories[cat].length;
                }
            });
            
            saveData();
        }
        
        function displayBaseline() {
            const display = document.getElementById('baselineDisplay');
            if (!personalBaseline || holes.length < 10) {
                display.innerHTML = '<div style="color: #999; text-align: center; padding: 20px;">„Éá„Éº„Çø‰∏çË∂≥Ôºà10„É©„Ç¶„É≥„Éâ‰ª•‰∏äÂøÖË¶ÅÔºâ</div>';
                return;
            }
            
            let html = '';
            Object.keys(personalBaseline).forEach(cat => {
                const val = personalBaseline[cat].toFixed(3);
                const sign = personalBaseline[cat] >= 0 ? '+' : '';
                const color = personalBaseline[cat] >= 0 ? '#2E7D32' : '#D32F2F';
                html += `<div class="baseline-item"><span>${cat}</span><span style="font-weight: 700; color: ${color};">${sign}${val}</span></div>`;
            });
            display.innerHTML = html;
        }
        
        function resetBaseline() {
            if (confirm('„Éô„Éº„Çπ„É©„Ç§„É≥„Çí„É™„Çª„ÉÉ„Éà„Åó„Åæ„Åô„ÅãÔºü')) {
                personalBaseline = null;
                saveData();
                displayBaseline();
            }
        }
        
        function getExpectedStrokes(distance, lie, wind, slope, greenCond) {
            let baseExpected = 0;
            
            if (distance <= 0) return 1.0;
            if (distance >= 400) return 5.3;
            
            const lower = Math.floor(distance / 5) * 5;
            const upper = lower + 5;
            const ratio = (distance - lower) / 5;
            baseExpected = EXPECTED_STROKES_DETAILED[lower] + (EXPECTED_STROKES_DETAILED[upper] - EXPECTED_STROKES_DETAILED[lower]) * ratio;
            
            const lieFactor = lie === '„É©„Éï' ? 1.10 : lie === '„Éê„É≥„Ç´„Éº' ? 1.15 : 1.00;
            const windFactor = wind === '„Éï„Ç©„É≠„ÉºÂº∑' ? 0.95 : wind.includes('„Ç¢„Ç≤„Ç§„É≥„Çπ„Éà') ? 1.10 : 1.00;
            const slopeFactor = SLOPE_FACTORS[slope] || 1.00;
            const greenFactor = GREEN_FACTORS[greenCond] || 1.00;
            
            return baseExpected * lieFactor * windFactor * slopeFactor * greenFactor;
        }
        
        function getPuttExpected(distanceM) {
            if (distanceM <= 1) return 1.20;
            if (distanceM >= 15) return 1.65;
            
            const lower = Math.floor(distanceM / 0.5) * 0.5;
            const upper = lower + 0.5;
            const ratio = (distanceM - lower) / 0.5;
            return PUTT_EXPECTED_DETAILED[lower] + (PUTT_EXPECTED_DETAILED[upper] - PUTT_EXPECTED_DETAILED[lower]) * ratio;
        }
        
        function calculateSG(beforeDist, afterDist, beforeLie, afterLie, wind, slope, greenCond) {
            let expectedBefore, expectedAfter;
            
            if (beforeLie === '„Ç∞„É™„Éº„É≥') {
                expectedBefore = getPuttExpected(beforeDist);
            } else {
                expectedBefore = getExpectedStrokes(beforeDist, beforeLie, wind, slope, greenCond);
            }
            
            if (afterDist === 0) {
                expectedAfter = 0;
            } else if (afterLie === '„Ç∞„É™„Éº„É≥') {
                expectedAfter = getPuttExpected(afterDist);
            } else {
                expectedAfter = getExpectedStrokes(afterDist, afterLie, wind, slope, greenCond);
            }
            
            return expectedBefore - (1 + expectedAfter);
        }
        
        function getSGCategory(shotNum, holePar, distance, lie) {
            if (lie === '„Ç∞„É™„Éº„É≥') return 'PUT';
            if (shotNum === 1) return holePar === 3 ? 'APP' : 'OTT';
            if (distance <= 30) return 'ARG';
            return 'APP';
        }
        
        function selectResult(btn, result) {
            selectedResult = result;
            document.querySelectorAll('.result-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
        }
        
        function predictNextSituation() {
            if (currentShots.length === 0) return '„ÉÜ„Ç£„Éº„Ç∞„É©„Ç¶„É≥„Éâ';
            
            const lastShot = currentShots[currentShots.length - 1];
            const lastClub = lastShot.club;
            const lastResult = lastShot.result;
            
            if (lastClub === 'PT') return '„Ç∞„É™„Éº„É≥';
            if (lastResult === '‚óé' || lastResult === '‚óã') {
                if (lastShot.situation === '„ÉÜ„Ç£„Éº„Ç∞„É©„Ç¶„É≥„Éâ') return '„Éï„Çß„Ç¢„Ç¶„Çß„Ç§';
                if (lastShot.situation === '„Éê„É≥„Ç´„Éº') return '„Ç∞„É™„Éº„É≥';
                return '„Ç∞„É™„Éº„É≥';
            }
            if (lastResult === '√ó') return '„É©„Éï';
            return '„Éï„Çß„Ç¢„Ç¶„Çß„Ç§';
        }
        
        function addShot() {
            const situation = document.getElementById('situation').value;
            const club = document.getElementById('club').value;
            const distanceBefore = parseFloat(document.getElementById('distanceBefore').value);
            const wind = appMode === 'advanced' ? document.getElementById('wind').value : 'ÁÑ°È¢®';
            const slope = appMode === 'advanced' ? document.getElementById('slope').value : 'Âπ≥Âù¶';
            const greenCondition = appMode === 'advanced' ? document.getElementById('greenCondition').value : 'ÊôÆÈÄö';
            
            if (!distanceBefore || !selectedResult) {
                alert('Ë∑ùÈõ¢„Å®ÁµêÊûú„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ');
                return;
            }
            
            let distanceAfter = null;
            let afterLie = null;
            
            if (appMode === 'advanced') {
                const afterInput = document.getElementById('distanceAfter').value;
                if (afterInput === '') {
                    alert('Êâì„Å£„ÅüÂæå„ÅÆÊÆãË∑ùÈõ¢„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑÔºà„Ç´„ÉÉ„Éó„Ç§„É≥„ÅÆÂ†¥Âêà„ÅØ0Ôºâ');
                    return;
                }
                distanceAfter = parseFloat(afterInput);
                afterLie = distanceAfter > 0 ? predictNextSituation() : '„Ç∞„É™„Éº„É≥';
            }
            
            currentShots.push({
                shotNumber: currentShots.length + 1,
                situation,
                club,
                distanceBefore,
                distanceAfter,
                afterLie,
                wind,
                slope,
                greenCondition,
                result: selectedResult,
                holePar: parseInt(document.getElementById('holePar').value)
            });
            
            document.getElementById('distanceBefore').value = '';
            if (appMode === 'advanced') {
                document.getElementById('distanceAfter').value = '';
                
                // Ê¨°„ÅÆÊâì„ÅÆ„ÄåÊâì„Å§Ââç„ÅÆÊÆãË∑ùÈõ¢„Äç„Å´Ëá™ÂãïÂèçÊò†
                if (distanceAfter !== null && distanceAfter > 0) {
                    setTimeout(() => {
                        document.getElementById('distanceBefore').value = distanceAfter;
                    }, 100);
                }
            }
            document.querySelectorAll('.result-btn').forEach(b => b.classList.remove('active'));
            selectedResult = null;
            
            const nextSituation = predictNextSituation();
            document.getElementById('situation').value = nextSituation;
            
            updateCurrentShots();
            document.getElementById('shotCount').textContent = currentShots.length + 1;
        }
        
        function updateCurrentShots() {
            const container = document.getElementById('currentShots');
            if (currentShots.length === 0) {
                container.style.display = 'none';
                return;
            }
            
            container.style.display = 'block';
            container.innerHTML = currentShots.map(s => {
                const beforeLabel = s.situation === '„Ç∞„É™„Éº„É≥' ? 'm' : 'yd';
                const afterLabel = s.afterLie === '„Ç∞„É™„Éº„É≥' ? 'm' : 'yd';
                let distText = `${s.distanceBefore}${beforeLabel}`;
                if (s.distanceAfter !== null) {
                    distText += ` ‚Üí ${s.distanceAfter === 0 ? '„Ç´„ÉÉ„Éó„Ç§„É≥' : s.distanceAfter + afterLabel}`;
                }
                return `<div class="shot-item">${s.shotNumber}ÊâìÁõÆ: ${s.situation} ‚Üí ${s.club} (${distText}) ‚Üí ${s.result}</div>`;
            }).join('');
        }
        
        function finishHole() {
            if (currentShots.length === 0) {
                alert('Â∞ë„Å™„Åè„Å®„ÇÇ1Êâì„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ');
                return;
            }
            
            const holePar = parseInt(document.getElementById('holePar').value);
            const puttCount = currentShots.filter(s => s.club === 'PT').length;
            
            holes.push({
                hole: currentHole,
                par: holePar,
                shots: [...currentShots],
                score: currentShots.length,
                putts: puttCount
            });
            
            currentShots = [];
            currentHole++;
            if (currentHole > 18) currentHole = 1;
            
            document.getElementById('currentHole').textContent = currentHole;
            document.getElementById('shotCount').textContent = 1;
            document.getElementById('situation').value = '„ÉÜ„Ç£„Éº„Ç∞„É©„Ç¶„É≥„Éâ';
            document.getElementById('holePar').value = '4';
            document.getElementById('distanceBefore').value = '';
            if (appMode === 'advanced') {
                document.getElementById('distanceAfter').value = '';
            }
            document.querySelectorAll('.result-btn').forEach(b => b.classList.remove('active'));
            selectedResult = null;
            
            updateCurrentShots();
            updateDisplay();
            calculateBaseline();
            saveData();
        }
        
        function switchTab(tabName) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
            
            document.querySelector(`[onclick="switchTab('${tabName}')"]`).classList.add('active');
            document.getElementById(tabName + 'Tab').classList.add('active');
            
            if (tabName === 'graphs') {
                setTimeout(() => {
                    updateCharts();
                    updateHeatmap();
                }, 100);
            }
        }
        
        function finishRound() {
            if (holes.length === 0) {
                alert('„É©„Ç¶„É≥„Éâ„Éá„Éº„Çø„Åå„ÅÇ„Çä„Åæ„Åõ„Çì');
                return;
            }
            
            if (!confirm('„É©„Ç¶„É≥„Éâ„ÇíÁµÇ‰∫Ü„Åó„Åæ„Åô„ÅãÔºü„Çπ„Ç≥„Ç¢Ë°®„Å®Ë©≥Á¥∞„Åå„É™„Çª„ÉÉ„Éà„Åï„Çå„Åæ„Åô„Åå„ÄÅÁµ±Ë®à„Éá„Éº„Çø„ÅØ‰øùÊåÅ„Åï„Çå„Åæ„Åô„ÄÇ')) {
                return;
            }
            
            // ÁèæÂú®„ÅÆ„É©„Ç¶„É≥„Éâ„Éá„Éº„Çø„ÇíÁµ±Ë®àÁî®„Å´‰øùÂ≠òÔºàholes„ÅØ„Åù„ÅÆ„Åæ„ÅæÁµ±Ë®àË®àÁÆó„Å´‰Ωø„Çè„Çå„ÇãÔºâ
            // „Çπ„Ç≥„Ç¢Ë°®Á§∫Áî®„ÅÆ„Éá„Éº„Çø„ÅÆ„Åø„ÇØ„É™„Ç¢
            currentShots = [];
            currentHole = 1;
            selectedResult = null;
            
            // UI„Çí„É™„Çª„ÉÉ„Éà
            document.getElementById('currentHole').textContent = 1;
            document.getElementById('shotCount').textContent = 1;
            document.getElementById('situation').value = '„ÉÜ„Ç£„Éº„Ç∞„É©„Ç¶„É≥„Éâ';
            document.getElementById('holePar').value = '4';
            document.getElementById('distanceBefore').value = '';
            if (appMode === 'advanced') {
                document.getElementById('distanceAfter').value = '';
            }
            document.querySelectorAll('.result-btn').forEach(b => b.classList.remove('active'));
            
            // „Çπ„Ç≥„Ç¢„Ç´„Éº„Éâ„Å®Ë©≥Á¥∞„Çø„Éñ„ÅÆË°®Á§∫„ÅÆ„Åø„ÇØ„É™„Ç¢
            updateCurrentShots();
            document.getElementById('scorecardContainer').innerHTML = '<div class="empty-message">Êñ∞„Åó„ÅÑ„É©„Ç¶„É≥„Éâ„ÇíÈñãÂßã„Åó„Å¶„Åè„Å†„Åï„ÅÑ</div>';
            document.getElementById('records').innerHTML = '<div class="empty-message">Êñ∞„Åó„ÅÑ„É©„Ç¶„É≥„Éâ„ÇíÈñãÂßã„Åó„Å¶„Åè„Å†„Åï„ÅÑ</div>';
            
            // Áµ±Ë®à„ÄÅ„Ç∞„É©„Éï„ÄÅSG„ÅØ‰øùÊåÅÔºàholes„Éá„Éº„Çø„ÅØÁµ±Ë®àÁî®„Å´ÊÆã„ÅôÔºâ
            // „Éô„Éº„Çπ„É©„Ç§„É≥„ÇÇÂÜçË®àÁÆó„Åó„Å¶‰øùÊåÅ
            calculateBaseline();
            updateStats();
            if (appMode === 'advanced') {
                updateSGStats();
            }
            
            saveData();
            
            alert('„É©„Ç¶„É≥„Éâ„ÅåÁµÇ‰∫Ü„Åó„Åæ„Åó„Åü„ÄÇÁµ±Ë®à„Éá„Éº„Çø„ÅØ‰øùÊåÅ„Åï„Çå„Å¶„ÅÑ„Åæ„Åô„ÄÇÊñ∞„Åó„ÅÑ„É©„Ç¶„É≥„Éâ„ÇíÈñãÂßã„Åß„Åç„Åæ„Åô„ÄÇ');
        }
        
        function resetAll() {
            if (holes.length === 0 || confirm('ÂÖ®„Å¶„ÅÆ„Éá„Éº„Çø„ÇíÂâäÈô§„Åó„Åæ„Åô„ÅãÔºü„Åì„ÅÆÊìç‰Ωú„ÅØÂèñ„ÇäÊ∂à„Åõ„Åæ„Åõ„Çì„ÄÇ')) {
                holes = [];
                currentShots = [];
                currentHole = 1;
                selectedResult = null;
                personalBaseline = null;
                
                document.getElementById('currentHole').textContent = 1;
                document.getElementById('shotCount').textContent = 1;
                document.getElementById('situation').value = '„ÉÜ„Ç£„Éº„Ç∞„É©„Ç¶„É≥„Éâ';
                document.getElementById('holePar').value = '4';
                document.getElementById('distanceBefore').value = '';
                if (appMode === 'advanced') {
                    document.getElementById('distanceAfter').value = '';
                }
                document.querySelectorAll('.result-btn').forEach(b => b.classList.remove('active'));
                
                updateCurrentShots();
                updateDisplay();
                saveData();
            }
        }
        
        function updateDisplay() {
            updateScorecard();
            updateStats();
            updateRecords();
            if (appMode === 'advanced') {
                updateSGStats();
            }
        }
        
        function updateScorecard() {
            const container = document.getElementById('scorecardContainer');
            
            if (holes.length === 0) {
                container.innerHTML = '<div class="empty-message">„Éá„Éº„Çø„Åå„ÅÇ„Çä„Åæ„Åõ„Çì</div>';
                return;
            }
            
            const holeScores = {}, holePutts = {};
            holes.forEach(h => {
                holeScores[h.hole] = h.score;
                holePutts[h.hole] = h.putts;
            });
            
            const frontNine = [], backNine = [], frontPutts = [], backPutts = [];
            let frontTotal = 0, backTotal = 0, frontPuttTotal = 0, backPuttTotal = 0;
            
            for (let i = 1; i <= 9; i++) {
                frontNine.push(holeScores[i] || '-');
                frontPutts.push(holePutts[i] || '-');
                if (holeScores[i]) frontTotal += holeScores[i];
                if (holePutts[i]) frontPuttTotal += holePutts[i];
            }
            
            for (let i = 10; i <= 18; i++) {
                backNine.push(holeScores[i] || '-');
                backPutts.push(holePutts[i] || '-');
                if (holeScores[i]) backTotal += holeScores[i];
                if (holePutts[i]) backPuttTotal += holePutts[i];
            }
            
            container.innerHTML = `
                <div class="scorecard">
                    <div class="scorecard-header">
                        <div class="scorecard-cell">HOLE</div>
                        ${Array.from({length: 9}, (_, i) => `<div class="scorecard-cell">${i + 1}</div>`).join('')}
                        <div class="scorecard-cell">OUT</div>
                    </div>
                    <div class="scorecard-row">
                        <div class="scorecard-cell">ÊâìÊï∞</div>
                        ${frontNine.map(s => `<div class="scorecard-cell">${s}</div>`).join('')}
                        <div class="scorecard-cell">${frontTotal || '-'}</div>
                    </div>
                    <div class="scorecard-row">
                        <div class="scorecard-cell">PT</div>
                        ${frontPutts.map(p => `<div class="scorecard-cell">${p}</div>`).join('')}
                        <div class="scorecard-cell">${frontPuttTotal || '-'}</div>
                    </div>
                </div>
                <div class="scorecard" style="margin-top: 12px;">
                    <div class="scorecard-header">
                        <div class="scorecard-cell">HOLE</div>
                        ${Array.from({length: 9}, (_, i) => `<div class="scorecard-cell">${i + 10}</div>`).join('')}
                        <div class="scorecard-cell">IN</div>
                    </div>
                    <div class="scorecard-row">
                        <div class="scorecard-cell">ÊâìÊï∞</div>
                        ${backNine.map(s => `<div class="scorecard-cell">${s}</div>`).join('')}
                        <div class="scorecard-cell">${backTotal || '-'}</div>
                    </div>
                    <div class="scorecard-row">
                        <div class="scorecard-cell">PT</div>
                        ${backPutts.map(p => `<div class="scorecard-cell">${p}</div>`).join('')}
                        <div class="scorecard-cell">${backPuttTotal || '-'}</div>
                    </div>
                </div>
                <div class="total-score">ÂêàË®à: ${frontTotal + backTotal} („Éë„ÉÉ„Éà${frontPuttTotal + backPuttTotal})</div>
            `;
        }
        
        function updateStats() {
            if (holes.length === 0) {
                document.getElementById('avgScore').textContent = '-';
                document.getElementById('totalHoles').textContent = '0';
                document.getElementById('fwRate').textContent = '-';
                document.getElementById('girRate').textContent = '-';
                document.getElementById('upDownRate').textContent = '-';
                document.getElementById('sandSaveRate').textContent = '-';
                document.getElementById('avgDistanceStats').innerHTML = '<div class="empty-message" style="grid-column: 1/-1;">„Éá„Éº„Çø„Å™„Åó</div>';
                document.getElementById('missStats').innerHTML = '„Éá„Éº„Çø„ÇíËøΩÂä†„Åó„Å¶„Åè„Å†„Åï„ÅÑ';
                return;
            }
            
            const allShots = holes.flatMap(h => h.shots);
            
            const avgScore = (holes.reduce((sum, h) => sum + h.score, 0) / holes.length).toFixed(1);
            document.getElementById('avgScore').textContent = avgScore;
            document.getElementById('totalHoles').textContent = holes.length;
            
            const par4or5Holes = holes.filter(h => h.par >= 4);
            let fwKeeps = 0;
            par4or5Holes.forEach(h => {
                if (h.shots.length >= 2 && h.shots[0].club === 'DR') {
                    if (['‚óé', '‚óã'].includes(h.shots[0].result) && h.shots[1].situation === '„Éï„Çß„Ç¢„Ç¶„Çß„Ç§') {
                        fwKeeps++;
                    }
                }
            });
            const fwRate = par4or5Holes.length > 0 ? ((fwKeeps / par4or5Holes.length) * 100).toFixed(0) : '-';
            document.getElementById('fwRate').textContent = fwRate === '-' ? '-' : fwRate + '%';
            
            let parOns = 0;
            holes.forEach(h => {
                const greenShots = h.shots.filter(s => s.situation === '„Ç∞„É™„Éº„É≥');
                if (greenShots.length > 0 && h.score - greenShots.length <= h.par - 2) {
                    parOns++;
                }
            });
            const girRate = ((parOns / holes.length) * 100).toFixed(0);
            document.getElementById('girRate').textContent = girRate + '%';
            
            let upDowns = 0, upDownChances = 0;
            holes.forEach(h => {
                const greenShots = h.shots.filter(s => s.situation === '„Ç∞„É™„Éº„É≥');
                if (greenShots.length > 0 && h.score - greenShots.length > h.par - 2) {
                    upDownChances++;
                    if (h.putts === 1) upDowns++;
                }
            });
            const upDownRate = upDownChances > 0 ? ((upDowns / upDownChances) * 100).toFixed(0) : '-';
            document.getElementById('upDownRate').textContent = upDownRate === '-' ? '-' : upDownRate + '%';
            
            let sandSaves = 0, sandChances = 0;
            holes.forEach(h => {
                const bunkerShots = h.shots.filter(s => s.situation === '„Éê„É≥„Ç´„Éº');
                if (bunkerShots.length > 0) {
                    sandChances++;
                    const bunkerIndex = h.shots.findIndex(s => s.situation === '„Éê„É≥„Ç´„Éº');
                    const afterBunker = h.shots.slice(bunkerIndex);
                    if (afterBunker.length === 2 && afterBunker[1].club === 'PT') {
                        sandSaves++;
                    }
                }
            });
            const sandSaveRate = sandChances > 0 ? ((sandSaves / sandChances) * 100).toFixed(0) : '-';
            document.getElementById('sandSaveRate').textContent = sandSaveRate === '-' ? '-' : sandSaveRate + '%';
            
            const clubDistances = {};
            allShots.forEach(s => {
                if (s.club !== 'PT' && s.distanceBefore) {
                    if (!clubDistances[s.club]) clubDistances[s.club] = [];
                    clubDistances[s.club].push(s.distanceBefore);
                }
            });
            
            let avgDistanceHTML = '';
            Object.keys(clubDistances).sort().forEach(club => {
                const avg = (clubDistances[club].reduce((a, b) => a + b, 0) / clubDistances[club].length).toFixed(0);
                avgDistanceHTML += `
                    <div class="stat-card">
                        <div class="stat-label">${club}</div>
                        <div class="stat-value">${avg}yd</div>
                    </div>
                `;
            });
            document.getElementById('avgDistanceStats').innerHTML = avgDistanceHTML || '<div class="empty-message" style="grid-column: 1/-1;">„Éá„Éº„Çø„Å™„Åó</div>';
            
            const misses = allShots.filter(s => s.result === '√ó').length;
            const missRate = ((misses / allShots.length) * 100).toFixed(0);
            document.getElementById('missStats').innerHTML = `„Éü„Çπ„Ç∑„Éß„ÉÉ„Éà: ${misses}Âõû (${missRate}%)`;
        }
        
        function updateSGStats() {
            if (holes.length === 0 || appMode !== 'advanced') {
                document.getElementById('sgTotal').textContent = '-';
                document.getElementById('sgT2G').textContent = '-';
                document.getElementById('sgOTT').textContent = '-';
                document.getElementById('sgAPP').textContent = '-';
                document.getElementById('sgARG').textContent = '-';
                document.getElementById('sgPUT').textContent = '-';
                document.getElementById('sgVsBaseline').textContent = '-';
                document.getElementById('clubSGStats').innerHTML = '„Éá„Éº„Çø„ÇíËøΩÂä†„Åó„Å¶„Åè„Å†„Åï„ÅÑ';
                return;
            }
            
            let sgOTT = 0, sgAPP = 0, sgARG = 0, sgPUT = 0;
            const clubSGs = {};
            
            holes.forEach(h => {
                h.shots.forEach(shot => {
                    if (shot.distanceAfter === null && shot.distanceAfter !== 0) return;
                    
                    const beforeDist = shot.distanceBefore;
                    const afterDist = shot.distanceAfter;
                    const beforeLie = shot.situation;
                    const afterLie = shot.afterLie || '„Ç∞„É™„Éº„É≥';
                    const wind = shot.wind || 'ÁÑ°È¢®';
                    const slope = shot.slope || 'Âπ≥Âù¶';
                    const greenCond = shot.greenCondition || 'ÊôÆÈÄö';
                    
                    const sg = calculateSG(beforeDist, afterDist, beforeLie, afterLie, wind, slope, greenCond);
                    const category = getSGCategory(shot.shotNumber, h.par, beforeDist, beforeLie);
                    
                    if (category === 'OTT') sgOTT += sg;
                    else if (category === 'APP') sgAPP += sg;
                    else if (category === 'ARG') sgARG += sg;
                    else if (category === 'PUT') sgPUT += sg;
                    
                    if (!clubSGs[shot.club]) {
                        clubSGs[shot.club] = { total: 0, count: 0 };
                    }
                    clubSGs[shot.club].total += sg;
                    clubSGs[shot.club].count++;
                });
            });
            
            const sgT2G = sgOTT + sgAPP + sgARG;
            const sgTotal = sgT2G + sgPUT;
            
            document.getElementById('sgTotal').textContent = sgTotal.toFixed(2);
            document.getElementById('sgT2G').textContent = sgT2G.toFixed(2);
            document.getElementById('sgOTT').textContent = sgOTT.toFixed(2);
            document.getElementById('sgAPP').textContent = sgAPP.toFixed(2);
            document.getElementById('sgARG').textContent = sgARG.toFixed(2);
            document.getElementById('sgPUT').textContent = sgPUT.toFixed(2);
            
            if (personalBaseline && Object.keys(personalBaseline).length > 0) {
                const baselineTotal = Object.values(personalBaseline).reduce((a, b) => a + b, 0);
                const vsBaseline = sgTotal - baselineTotal;
                const sign = vsBaseline >= 0 ? '+' : '';
                document.getElementById('sgVsBaseline').textContent = sign + vsBaseline.toFixed(2);
            } else {
                document.getElementById('sgVsBaseline').textContent = '-';
            }
            
            let clubSGHTML = '';
            Object.keys(clubSGs).sort().forEach(club => {
                const avg = (clubSGs[club].total / clubSGs[club].count).toFixed(3);
                const color = parseFloat(avg) >= 0 ? '#2E7D32' : '#D32F2F';
                const sign = parseFloat(avg) >= 0 ? '+' : '';
                clubSGHTML += `
                    <div style="display: flex; justify-content: space-between; align-items: center; padding: 8px 0; border-bottom: 1px solid #E0E0E0;">
                        <span style="font-weight: 600;">${club}</span>
                        <span style="color: ${color}; font-weight: 700;">${sign}${avg}</span>
                    </div>
                `;
            });
            document.getElementById('clubSGStats').innerHTML = clubSGHTML || '„Éá„Éº„Çø„Å™„Åó';
        }
        
        function updateRecords() {
            const recordsDiv = document.getElementById('records');
            
            if (holes.length === 0) {
                recordsDiv.innerHTML = '<div class="empty-message">„Éá„Éº„Çø„Åå„ÅÇ„Çä„Åæ„Åõ„Çì</div>';
            } else {
                recordsDiv.innerHTML = holes.map(h => `
                    <div class="hole-record">
                        <div class="hole-record-header">„Éõ„Éº„É´ ${h.hole} - Par${h.par} - ${h.score}Êâì („Éë„ÉÉ„Éà${h.putts})</div>
                        ${h.shots.map(s => {
                            const beforeLabel = s.situation === '„Ç∞„É™„Éº„É≥' ? 'm' : 'yd';
                            const afterLabel = s.afterLie === '„Ç∞„É™„Éº„É≥' ? 'm' : 'yd';
                            let distText = `${s.distanceBefore}${beforeLabel}`;
                            if (s.distanceAfter !== null) {
                                distText += ` ‚Üí ${s.distanceAfter === 0 ? '„Ç´„ÉÉ„Éó„Ç§„É≥' : s.distanceAfter + afterLabel}`;
                            }
                            return `
                                <div class="shot-detail">
                                    ${s.shotNumber}ÊâìÁõÆ: ${s.situation} ‚Üí ${s.club} (${distText}) ‚Üí ${s.result}
                                </div>
                            `;
                        }).join('')}
                    </div>
                `).join('');
            }
        }
        
        function updateCharts() {
            if (holes.length === 0) return;
            
            const ctx1 = document.getElementById('scoreChart');
            if (scoreChart) scoreChart.destroy();
            
            scoreChart = new Chart(ctx1, {
                type: 'line',
                data: {
                    labels: holes.map(h => `H${h.hole}`),
                    datasets: [{
                        label: '„Çπ„Ç≥„Ç¢',
                        data: holes.map(h => h.score),
                        borderColor: '#2E7D32',
                        backgroundColor: 'rgba(46,125,50,0.1)',
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    plugins: { legend: { display: false } },
                    scales: {
                        y: { beginAtZero: false }
                    }
                }
            });
            
            const scoreDist = { '„Éê„Éº„Éá„Ç£‰ª•‰∏ã': 0, '„Éë„Éº': 0, '„Éú„ÇÆ„Éº': 0, '„ÉÄ„Éñ„É´„Éú„ÇÆ„Éº‰ª•‰∏ä': 0 };
            holes.forEach(h => {
                const diff = h.score - h.par;
                if (diff <= -1) scoreDist['„Éê„Éº„Éá„Ç£‰ª•‰∏ã']++;
                else if (diff === 0) scoreDist['„Éë„Éº']++;
                else if (diff === 1) scoreDist['„Éú„ÇÆ„Éº']++;
                else scoreDist['„ÉÄ„Éñ„É´„Éú„ÇÆ„Éº‰ª•‰∏ä']++;
            });
            
            const ctx2 = document.getElementById('scoreDistChart');
            if (distChart) distChart.destroy();
            
            distChart = new Chart(ctx2, {
                type: 'doughnut',
                data: {
                    labels: Object.keys(scoreDist),
                    datasets: [{
                        data: Object.values(scoreDist),
                        backgroundColor: ['#4CAF50', '#8BC34A', '#FFC107', '#FF5722']
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: { position: 'bottom' }
                    }
                }
            });
        }
        
        function updateHeatmap() {
            const heatmap = document.getElementById('heatmap');
            if (holes.length === 0) {
                heatmap.innerHTML = '<div style="grid-column: 1/-1; text-align: center; color: #999;">„Éá„Éº„Çø„Å™„Åó</div>';
                return;
            }
            
            const ranges = [
                { label: '~50', min: 0, max: 50 },
                { label: '50-100', min: 50, max: 100 },
                { label: '100-150', min: 100, max: 150 },
                { label: '150-200', min: 150, max: 200 },
                { label: '200+', min: 200, max: 999 }
            ];
            
            let html = '';
            ranges.forEach(range => {
                const shots = holes.flatMap(h => h.shots).filter(s => 
                    s.distanceBefore >= range.min && s.distanceBefore < range.max && s.situation !== '„Ç∞„É™„Éº„É≥'
                );
                const goodShots = shots.filter(s => ['‚óé', '‚óã'].includes(s.result)).length;
                const rate = shots.length > 0 ? (goodShots / shots.length) : 0;
                
                const color = rate >= 0.7 ? '#4CAF50' : rate >= 0.5 ? '#FFC107' : rate >= 0.3 ? '#FF9800' : '#FF5722';
                const textColor = 'white';
                
                html += `
                    <div class="heatmap-cell" style="background: ${color}; color: ${textColor};">
                        <div style="font-size: 9px;">${range.label}yd</div>
                        <div style="font-size: 16px; font-weight: 700;">${(rate * 100).toFixed(0)}%</div>
                        <div style="font-size: 8px;">${shots.length}Êâì</div>
                    </div>
                `;
            });
            
            heatmap.innerHTML = html;
        }
        
        init();
    </script>
</body>
</html>